{{> organisms-navbar("extraClass":"navbar-fixed-top")}}
{{> organisms-secondary-navbar("showBackButton":true,"pageTitle": "Contract 123456","hideNextPreviousButtons":false, "showConfigureButton":false, "extraClass":"navbar-fixed-top")}}

<div class="container-fluid page-top-padding">
    <div class="form-group">
        <div id="contractWorkspaceAlert" class="alert alert-success center-block hide fade in out slide-out-top" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <div><strong>Success!</strong> <span id="contractWorkspaceAlertMessage"></span></div>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12">
            <div class="form-group">
                {{> templates-nav-wizard }}
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div id="left" class="col-sm-6">
                <style>
                    #saveMetaDataAlert {
                        top: 5px;
                        position: absolute;
                        width: 87.5%;
                        margin: 0 auto;
                        padding: 10px 15px;
                    }
                </style>
                <!-- Contract Meta Data Panel -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">
                            Contract Header
                            <div class="btn-group btn-group-sm pull-right">
                                <button id="editMetaDataBtn" class="btn btn-default btn-sm" style="margin: 0;" onclick=" $('#metaDataForm').attr('disabled', !$('#metaDataForm').attr('disabled')); $('#metaDataSaveBtn').toggleClass('hide'); $('#metaDataCancelBtn').toggleClass('hide'); $(this).toggleClass('hide');">Edit</button>
                                <button id="metaDataSaveBtn" class="btn btn-success hide" onclick=" $('#editMetaDataBtn').toggleClass('hide'); $('#metaDataCancelBtn').toggleClass('hide'); $(this).toggleClass('hide'); $('#metaDataForm').attr('disabled', !$('#metaDataForm').attr('disabled')); showAlertDialog('success','Success!  Your changes have been saved.', true); ">Save</button>
                                <button id="metaDataCancelBtn" class="btn btn-default hide" onclick=" $('#editMetaDataBtn').toggleClass('hide'); $('#metaDataSaveBtn').toggleClass('hide'); $(this).toggleClass('hide'); $('#metaDataForm').attr('disabled', !$('#metaDataForm').attr('disabled')); ">Cancel</button>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div id="saveMetaDataAlert" class="alert alert-success center-block hide fade in out slide-out-top" role="alert">
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <strong>Success!</strong> The contract meta data <strong id="newPricebookName"></strong> was saved
                            successfully!
                        </div>
                        <fieldset id="metaDataForm" disabled>
                            <div class="row">
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label">Contract Name {{> atoms-required-field-indicator}}</label>
                                        <input type="text" class="form-control" value="Contract 123456">
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label">Contract Number {{> atoms-required-field-indicator}}</label>
                                        <input type="text" class="form-control" value="123456">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label">Contract Status</label>
                                        <select class="form-control" id="select" disabled="">
                                            <option>Draft</option>
                                            <option selected>Internal Review</option>
                                            <option>Supplier Review</option>
                                            <option>Approved</option>
                                            <option>Executed</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label">Parent Contract </label>
                                        <input id="parentContractFld" value="Contract 123" type="text" placeholder="Type to search by contract name..."
                                            class="form-control">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label">Supplier Name{{> atoms-required-field-indicator}}</label>
                                <input id="supplierNameFld" value="Acme Oilfield Services" type="text" class="form-control">
                            </div>

                            <div class="form-group">
                                <label class="control-label">Description</label>
                                <textarea rows="1" class="form-control">Contract for drilling & completions services provided by Acme Oilfield Services</textarea>
                            </div>


                            <div class="row">
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label">Location</label>
                                        <input type="text" class="form-control" value="6378137 298.257222">
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label">Department {{> atoms-required-field-indicator}}</label>
                                        <input type="text" class="form-control" value="Field Services">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label">Amount</label>
                                        <input type="text" class="form-control" value="35,000,000.00">
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label">Budgeted Amount {{> atoms-required-field-indicator}}</label>
                                        <input type="text" class="form-control">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label">Spend Category {{> atoms-required-field-indicator}}</label>
                                        <input type="text" class="form-control" value="Drilling Operations">
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        {{> organisms-currency-dropdown("defaultCurrencyCode":"CAD")}}
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label">Start Date {{> atoms-required-field-indicator}}</label>
                                        <input type="text" class="form-control" value="01/01/2018">
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label">End Date</label>
                                        <input type="text" class="form-control">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">

                            </div>
                        </fieldset>
                    </div>
                </div>

                <!-- Comments Panel -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">
                            Comments
                            <div class="btn-group btn-group-sm pull-right">
                                <button class="btn btn-default btn-sm" onclick="openAddCommentModal();">Add a Comment</button>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="panel-body">
                        {{> templates-comments-list }}
                    </div>
                </div>

                <!-- Document Journal Panel -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">Document Journal</div>
                    </div>
                    <div class="panel-body">
                        {{> templates-document-journal }}
                    </div>
                </div>

                <!-- Team Panel -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">
                            Team
                            <div class="btn-group btn-group-sm pull-right">
                                <button class="btn btn-default" onclick="openTeamModal();">Manage Team</button>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <div class="table-responsive">
                                <table id="teamList" class="table table-bordered table-responsive table-condensed">
                                    <thead>
                                        <tr class="text-nowrap">
                                            <th>Name</th>
                                            <th>Role</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="text-nowrap">
                                            <td>Greg Wilson</td>
                                            <td>Reviewer, Modifier</td>
                                        </tr>
                                        <tr class="text-nowrap">
                                            <td>Harold Winters</td>
                                            <td>Reviewer, Modifier</td>
                                        </tr>
                                        <tr class="text-nowrap">
                                            <td>Tina Smithers</td>
                                            <td>Reviewer, Modifier</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="right" class="col-sm-6">
                <!-- Contract Panel -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">
                            Contract
                            <div class="btn-group btn-group-sm pull-right">
                                <button class="btn btn-default btn-sm" onclick="showFileUploadDialog();">Upload New Version</button>
                                <button class="btn btn-default btn-sm">Download Current Version</button>
                            </div>
                            <script>
                                function showFileUploadDialog() {
                                    var x = document.createElement("INPUT");
                                    x.setAttribute("type", "file");
                                    x.setAttribute("id","fileUploadDialog")
                                    x.style.display = "none";
                                    document.body.appendChild(x);
                                    x.click();

                                    $("#fileUploadDialog").change(function(){
                                            showNavbarFeedback('success', "Success!  The new version of the contract was successfully uploaded.");
                                    });
                                }
                            </script>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="scrollable-panel-body panel-resizable">
                            <iframe src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/317356/sampleContractTemplate.png" style="width:100%; border-color: #333;" height="880px" frameborder="0"></iframe>
                        </div>
                    </div>
                </div>
                <!-- Attachments Panel -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">
                            Attachments

                            <div class="btn-group btn-group-sm pull-right">
                                <button class="btn btn-sm btn-default" onclick="showFileUploadDialog();">Add an Attachment</button>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <table id="assignedPricebooksList" width="100%" class="table table-bordered table-striped">
                            <thead>
                                <tr class="text-nowrap">
                                    <th class="text-nowrap">File Name</th>
                                    <th class="text-center" width="36">Remove</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="text-nowrap">Attachment1.pdf</td>
                                    <td class="text-center" width="36">
                                        <a class="btn btn-block"><i class="fas fa-minus-circle"></i></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-nowrap">Attachment2.png</td>
                                    <td class="text-center" width="36">
                                        <a class="btn btn-block"><i class="fas fa-minus-circle"></i></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Price Books Panel -->
                <style>
                    #pricebookFeedback {
                        width: 90%;
                        margin: 0 auto;
                        padding: 10px 15px;
                        position: absolute;
                        z-index: 1;
                    }
                </style>
                <div class="panel panel-default">
                    <div id="pricebookFeedback" class="alert alert-success hide fade in out slide-out-top ">
                        <a href="#" class="close" onclick="$('#pricebookFeedback').toggleClass('slide-out-top');" aria-label="close">&times;</a>
                        <span class="alertMessageContent"> </span>
                    </div>
                    <div class="panel-heading">
                        <div class="panel-title">
                            Price Books

                            <div class="btn-group btn-group-sm pull-right">
                                <button class="btn btn-sm btn-default" onclick="if($('#supplierNameFld').val()){ $('#associatePricebookSupplierName').text(' for ' +$('#supplierNameFld').val())}; openAssociatePriceBookModal();">Add Existing Price Book</button>
                                <button class="btn btn-sm btn-default" onclick="if($('#supplierNameFld').val()){ $('#createPricebookSupplierName').text(' for ' +$('#supplierNameFld').val())}; openCreatePriceBookModal();">Create New Price Book</button>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="panel-body scrollable-panel-body">

                        <!--div class="form-group">
                            <label class="control-label">Price Book Search</label>
                            <div class="input-group">
                                <input id="pricebookMetaDataField" type="text" class="form-control" placeholder="Type to search for an existing price book...">
                                <span class="input-group-btn">
                                    <button class="btn btn-default" onclick="if($('#supplierNameFld').val()){ $('#createPricebookSupplierName').text(' for ' +$('#supplierNameFld').val())}; openCreatePriceBookModal();"><i class="fas fa-plus-circle text-success"></i> Create New Price Book</button>
                                </span>
                            </div>
                        </div-->

                        <table id="assignedPricebooksList" class="table table-bordered table-striped">
                            <caption>Assigned Price Books</caption>
                            <thead>
                                <tr class="text-nowrap">
                                    <th class="text-nowrap">Price Book Name</th>
                                    <th>Description</th>
                                    <th>Value</th>
                                    <th>Min Value</th>
                                    <th>Max Value</th>
                                    <th class="text-center">Remove</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="text-nowrap">PB-2018-Compl-CAN</td>
                                    <td>2018 D&C Canadian Pricing</td>
                                    <td><small>CAD</small> 250,000</td>
                                    <td><small>CAD</small> 20,000</td>
                                    <td><small>CAD</small> 250,000</td>
                                    <td class="text-center">
                                        <a class="btn btn-block"><i class="fas fa-minus-circle"></i></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div id="new-pricebook-modal" class="modal fade in">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 id="contract-workspace-modal-title" class="modal-title">Create Price Book <strong id="createPricebookSupplierName"></strong></h4>
            </div>
            <div  id="contract-workspace-modal-body" class="modal-body">
                <div class="form-group">
                    <label class="control-label">Price Book Name {{> atoms-required-field-indicator}}</label>
                    <input id="contractWorkspaceNewPricebookName" type="text" class="form-control" placeholder="">
                    <script>
                        function getPricebookName() { var now= new Date(); return 'PB-' +now.getFullYear() +'-' +now.getMonth() +'-' +now.getDate() +'-' +now.getSeconds();  }
                        //$('#contractWorkspaceNewPricebookName').val(getPricebookName());
                    </script>
                </div>
                <div class="form-group">
                    <label class="control-label">Price Book Description {{> atoms-required-field-indicator}}</label>
                    <input type="text" class="form-control" placeholder="" >
                </div>
                <div class="form-group">
                    {{> organisms-currency-dropdown }}
                </div>
                 <div class="form-group">
                    <label class="control-label">Price Book Value {{> atoms-required-field-indicator}}</label>
                    <input type="text" class="form-control" placeholder="" >
                </div>
                <div class="form-group">
                    <label class="control-label">Minimum Value {{> atoms-required-field-indicator}}</label>
                    <input type="text" class="form-control" placeholder="" >
                </div>
                <div class="form-group">
                    <label class="control-label">Maximum Value {{> atoms-required-field-indicator}}</label>
                    <input type="text" class="form-control" placeholder="" >
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default " data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button type="button" class="btn btn-success pull-right" data-dismiss="modal" aria-hidden="true" onclick=" $('#newPricebookName').html($('#contractWorkspaceNewPricebookName').val()); showAlertDialog('success','<strong>Success!</strong> The price book was added successfully.', true);">Save and Add Price Book</button>
            </div>
        </div>
    </div>
</div>

<div id="associate-pricebook-modal" class="modal fade in">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 id="contract-workspace-modal-title" class="modal-title">Add Existing Price Book <strong id="associatePricebookSupplierName"></strong></h4>
            </div>
            <div  id="contract-workspace-modal-body" class="modal-body">
                <div class="form-group">
                    <label class="control-label">Price Book Search </label>
                    <input id="contractWorkspaceNewPricebookName" type="text" class="form-control" placeholder="Search by price book name, number, or supper name...">
                </div>

                <div class="form-group">
                    <button id="searchPricebooksBtn" class="btn btn-default">Search</button>
                </div>

                <div class="form-group">
                    <div class="table-responsive">
                        <table id="priceBookSearchResults" class="table">
                            <thead>
                                <tr class="text-nowrap">
                                    <th>Select</th>
                                    <th class="text-nowrap">Price Book Name</th>
                                    <th>Description</th>
                                    <th>Value</th>
                                    <th>Min Value</th>
                                    <th>Max Value</th>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default " data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button type="button" class="btn btn-success pull-right" data-dismiss="modal" aria-hidden="true" onclick="showAlertDialog('success','<strong>Success!</strong> The price book was added successfully.', true);">Add Selected</button>
            </div>
        </div>
    </div>
</div>

<div id="add-comment-modal" class="modal fade in">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">Add a Comment</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="control-label">Comment {{> atoms-required-field-indicator}}</label>
                    <textarea rows="5" class="form-control"></textarea>
                </div>
            </div>
            <div class="modal-footer text-right">
                <button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button type="button" class="btn btn-success pull-right" data-dismiss="modal" aria-hidden="true" >Save</button>
            </div>
        </div>
    </div>
</div>

<div id="contract-workspace-modal" class="modal fade in">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 id="contract-workspace-modal-title" class="modal-title">Manage Team</h4>
            </div>
            <div  id="contract-workspace-modal-body" class="modal-body">
                <div class="form-group">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Type to search for a user or department..." >
                        <span class="input-group-addon">
                            Add to Team
                        </span>
                    </div>
                </div>
                <hr/>

                <div class="">
                    <table id="editTeamList" class="table table-bordered table-striped table-condensed">
                        <thead>
                            <tr class="text-nowrap">
                                <th>Name</th>
                                <th width="35">Role</th>
                                <th class="text-center" width="15">Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="text-nowrap">
                                <td>Greg Wilson</td>
                                <td>
                                    {{> molecules-multi-select("multiSelectButtonText":"Reviewer, Modifier","showContractOptions": "true") }}
                                </td>
                                <td class="text-center">
                                    <button class="btn btn-block"><i class="fas fa-trash-alt"></i></button>
                                </td>
                            </tr>
                            <tr class="text-nowrap">
                                <td>Harold Winters</td>
                                <td>
                                    {{> molecules-multi-select("multiSelectButtonText":"Reviewer, Modifier","showContractOptions": "true") }}
                                </td>
                                <td class="text-center">
                                    <button class="btn btn-block"><i class="fas fa-trash-alt"></i></button>
                                </td>
                            </tr>
                            <tr class="text-nowrap">
                                <td>Tina Smithers</td>
                                <td>
                                    {{> molecules-multi-select("multiSelectButtonText":"Reviewer, Modifier","showContractOptions": "true") }}
                                </td>
                                <td class="text-center">
                                    <button class="btn btn-block"><i class="fas fa-trash-alt"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <span class="pull-right">
                    <button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">Cancel</button>
                    <button type="button" class="btn btn-success" data-dismiss="modal" aria-hidden="true" onclick="showAlertDialog('success','<strong>Success!</strong> The team was successfully updated.', true);">Save</button>
                </span>
            </div>
        </div>
    </div>
</div>

<script>
    dragula([document.getElementById('left'), document.getElementById('right')]);

    var dataSet = [
        [ "Acme-2018-D&C-CAN", "2018 D&C Canadian Pricing", "Acme 2018 Canadian Drilling & Completions Pricing", "CAD 500,000.00", "CAD 50,000.00", "CAD 750,000.00" ],
        [ "Acme-2018-Drill-US", "2018 Drilling US Pricing", "Acme 2018 US Drilling Services Pricing", "USD 750,000.00", "USD 125,000.00", "CAD 850,000.00" ],
        [ "Acme-2018-Haul-US", "2018 Water Hauling US Pricing", "Acme 2018 US Water Hauling Pricing", "USD 75,000.00", "USD 10,000.00", "CAD 80,000.00" ],
        [ "Acme-2019-D&C-US", "2019 D&C US Pricing", "Acme 2019 US Drilling & Completions Pricing", "USD 950,000.00", "USD 65,000.00", "CAD 129,000.00" ]
    ];


    $('#searchPricebooksBtn').on('click', function() {
        $('#priceBookSearchResults').DataTable( {
            oLanguage: defaultDataTablesOLanguage,
            data: dataSet,
            columns: [
                 {
                    render: function ( data, type, row ) {
                        if ( type === 'display' ) {
                            return '<div class="checkbox"><label><input type="checkbox"></label></div>';
                        }
                        return data;
                    },
                    className: "dt-body-center"
                },
                { title: "Price Book Name" },
                { title: "Description" },
                { title: "Value" },
                { title: "Min Value" },
                { title: "Max Value" }
            ]
        } );
    } );

    $("#contWorkspaceCurrencyDropdownMenu").ready(function() {
        $.ajax({
            url: "../../styleguide/data/currencies.json",
            type: "GET",
            success: function(response) {
                var responseData = response;
                $.each(responseData , function(i,obj) {
                    var menuItem = '<li onclick="$(\'#currencyCodeDisplay\').html(\' ' +obj.code +' \')"><a id="' +obj.number +' href="#nogo">' +obj.code +'   <small class="text-muted">(' +obj.name +')</small></a></li>';
                    $(menuItem).appendTo('#contWorkspaceCurrencyDropdownMenu');
                });
            }
        });
    });

    function openTeamModal() {
        $('#contract-workspace-modal-title').html("Manage Team");
        $('#contract-workspace-modal').modal();
        $('[data-toggle="popover"]').popover();
    }

    function openAssociatePriceBookModal() {
        $('#associate-pricebook-modal').modal();
    }

    function openCreatePriceBookModal() {
        $('#new-pricebook-modal').modal();
    }

    function openAddCommentModal() {
        $('#add-comment-modal').modal();
    }

    $('body').addClass('page-bg');
</script>
